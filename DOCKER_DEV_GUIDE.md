# Docker å¼€å‘ç¯å¢ƒå¿«é€ŸæŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### é¦–æ¬¡å¯åŠ¨ï¼ˆå…¨é‡åˆå§‹åŒ–ï¼‰

```bash
# èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™
chmod +x bin/*.sh

# åˆå§‹åŒ–å¼€å‘ç¯å¢ƒï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰
./bin/init-dev.sh
```

### æ—¥å¸¸å¼€å‘

æ›´æ–°ä»£ç åï¼Œ**åªéœ€é‡å»ºä¿®æ”¹çš„æ¨¡å—**ï¼Œæ— éœ€å®Œæ•´é‡å¯æ‰€æœ‰æœåŠ¡ï¼š

```bash
# æ›´æ–° Admin åç«¯æ¨¡å—
./bin/rebuild.sh admin

# æ›´æ–° Portal åç«¯æ¨¡å—
./bin/rebuild.sh portal

# æ›´æ–°å‰ç«¯
./bin/rebuild.sh frontend

# æ›´æ–°æ‰€æœ‰åç«¯æ¨¡å—
./bin/rebuild.sh backend

# æ›´æ–°æ‰€æœ‰æ¨¡å—
./bin/rebuild.sh all
```

## ğŸ“ è„šæœ¬è¯´æ˜

æ‰€æœ‰è„šæœ¬éƒ½ä½äº `bin/` ç›®å½•ä¸‹ï¼š

| è„šæœ¬                      | ç”¨é€”                           |
| ------------------------- | ------------------------------ |
| `bin/init-dev.sh`         | é¦–æ¬¡åˆå§‹åŒ–å¼€å‘ç¯å¢ƒï¼Œå…¨é‡æ„å»º   |
| `bin/rebuild.sh`          | ç»Ÿä¸€æ¨¡å—é‡å»ºå·¥å…·ï¼ˆæ¨èä½¿ç”¨ï¼‰   |
| `bin/rebuild-admin.sh`    | å•ç‹¬é‡å»º Admin æ¨¡å—            |
| `bin/rebuild-portal.sh`   | å•ç‹¬é‡å»º Portal æ¨¡å—           |
| `bin/rebuild-frontend.sh` | å•ç‹¬é‡å»ºå‰ç«¯æ¨¡å—               |
| `bin/stop-dev.sh`         | åœæ­¢å¼€å‘ç¯å¢ƒ                   |
| `bin/start-dev.sh`        | å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼ˆMockæ¨¡å¼ï¼‰ |

## ğŸ› ï¸ rebuild.sh ç”¨æ³•

```bash
./bin/rebuild.sh <æ¨¡å—> [é€‰é¡¹]

# æ¨¡å—é€‰é¡¹:
#   admin      - Admin åç«¯æ¨¡å—
#   portal     - Portal åç«¯æ¨¡å—
#   frontend   - å‰ç«¯æ¨¡å—
#   backend    - æ‰€æœ‰åç«¯æ¨¡å— (admin + portal)
#   all        - æ‰€æœ‰æ¨¡å—
#   infra      - ä»…å¯åŠ¨åŸºç¡€è®¾æ–½
#   status     - æŸ¥çœ‹å®¹å™¨çŠ¶æ€
#   logs       - æŸ¥çœ‹åº”ç”¨æ—¥å¿—

# å¯é€‰å‚æ•°:
#   --skip-build   è·³è¿‡ç¼–è¯‘ï¼Œä»…é‡å»ºé•œåƒå¹¶é‡å¯
#   --logs         é‡å¯åæ˜¾ç¤ºå®¹å™¨æ—¥å¿—
#   --force        å¼ºåˆ¶é‡å»ºï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼‰
```

### å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹

```bash
# ä¿®æ”¹äº† admin-module ä»£ç å
./bin/rebuild.sh admin

# ä¿®æ”¹äº† admin-module ä»£ç ï¼Œæƒ³æŸ¥çœ‹æ—¥å¿—
./bin/rebuild.sh admin --logs

# åªæ”¹äº†é…ç½®ï¼Œä¸éœ€è¦é‡æ–°ç¼–è¯‘ Java
./bin/rebuild.sh admin --skip-build

# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çŠ¶æ€
./bin/rebuild.sh status

# æŒç»­æŸ¥çœ‹åº”ç”¨æ—¥å¿—
./bin/rebuild.sh logs
```

## ğŸ—ï¸ é…ç½®æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶                               | ç”¨é€”                           |
| ---------------------------------- | ------------------------------ |
| `docker-compose.yml`               | åŸå§‹é…ç½®ï¼ˆå®Œæ•´æ„å»ºï¼Œé€‚åˆç”Ÿäº§ï¼‰ |
| `docker-compose.dev.yml`           | å¼€å‘é…ç½®ï¼ˆä½¿ç”¨æœ¬åœ°é¢„ç¼–è¯‘æ–‡ä»¶ï¼‰ |
| `backend/admin.Dockerfile`         | Admin æ¨¡å—è¿è¡Œé•œåƒ             |
| `backend/portal-run.Dockerfile`    | Portal æ¨¡å—è¿è¡Œé•œåƒ            |
| `frontend/frontend-run.Dockerfile` | å‰ç«¯è¿è¡Œé•œåƒ                   |

## âš¡ æ€§èƒ½å¯¹æ¯”

| æ“ä½œ             | åŸæ–¹å¼ (docker-compose down/up) | æ–°æ–¹å¼ (rebuild.sh) |
| ---------------- | ------------------------------- | ------------------- |
| ä¿®æ”¹å•ä¸ªåç«¯æ¨¡å— | ~3-5 åˆ†é’Ÿ                       | ~30-60 ç§’           |
| ä¿®æ”¹å‰ç«¯ä»£ç      | ~2-3 åˆ†é’Ÿ                       | ~20-40 ç§’           |
| ä¿®æ”¹æ‰€æœ‰æ¨¡å—     | ~5-8 åˆ†é’Ÿ                       | ~2-3 åˆ†é’Ÿ           |

## ğŸ”§ å·¥ä½œåŸç†

### åŸæ–¹å¼é—®é¢˜

1. æ¯æ¬¡éƒ½åœ¨ Docker å®¹å™¨å†…æ‰§è¡Œ Maven/npm æ„å»º
2. Docker æ„å»ºç¼“å­˜ç»å¸¸å¤±æ•ˆ
3. éœ€è¦å®Œæ•´é‡å»ºæ‰€æœ‰æœåŠ¡

### æ–°æ–¹å¼ä¼˜åŒ–

1. **æœ¬åœ°é¢„ç¼–è¯‘**ï¼šåœ¨å®¿ä¸»æœºæ‰§è¡Œ Maven/npm æ„å»ºï¼Œåˆ©ç”¨æœ¬åœ°ç¼“å­˜
2. **è½»é‡è¿è¡Œé•œåƒ**ï¼šDocker ä»…å¤åˆ¶ç¼–è¯‘å¥½çš„ JAR/dist æ–‡ä»¶
3. **æ¨¡å—åŒ–é‡å¯**ï¼šåªé‡å»ºå’Œé‡å¯ä¿®æ”¹çš„æ¨¡å—

## ğŸ› æ•…éšœæ’é™¤

### ä»£ç æ›´æ–°åå®¹å™¨ä¸­ä»æ˜¯æ—§ä»£ç 

```bash
# å¼ºåˆ¶é‡å»ºï¼Œä¸ä½¿ç”¨ç¼“å­˜
./bin/rebuild.sh admin --force

# æˆ–è€…å®Œå…¨åˆ é™¤é•œåƒåé‡å»º
docker rmi mini-customer-service-backend:dev
./bin/rebuild.sh admin
```

### Maven æ„å»ºå¤±è´¥

```bash
# å…ˆåœ¨æœ¬åœ°ç¡®è®¤èƒ½æ„å»ºæˆåŠŸ
cd backend
mvn clean package -DskipTests

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
mvn -pl admin-module -am package -DskipTests
```

### å®¹å™¨å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.dev.yml logs backend-api

# æˆ–ä½¿ç”¨è„šæœ¬
./bin/rebuild.sh logs
```

### æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# ç¡®ä¿åŸºç¡€è®¾æ–½å·²å¯åŠ¨
./bin/rebuild.sh infra

# ç­‰å¾…æ•°æ®åº“å°±ç»ªåå†å¯åŠ¨åº”ç”¨
sleep 10
./bin/rebuild.sh backend
```

## ğŸ—‚ï¸ æœåŠ¡è®¿é—®åœ°å€

| æœåŠ¡       | åœ°å€                  |
| ---------- | --------------------- |
| å‰ç«¯       | http://localhost      |
| Admin API  | http://localhost:8080 |
| Portal API | http://localhost:8082 |
| PostgreSQL | localhost:5432        |
| Redis      | localhost:6379        |

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å¼€å‘æ—¶ä½¿ç”¨ `docker-compose.dev.yml`**
2. **åªé‡å»ºä¿®æ”¹çš„æ¨¡å—**ï¼Œé¿å…å…¨é‡æ„å»º
3. **ä½¿ç”¨ `--logs` é€‰é¡¹** å¿«é€ŸæŸ¥çœ‹å¯åŠ¨æ—¥å¿—
4. **é¦–æ¬¡ä½¿ç”¨** è¿è¡Œ `./bin/init-dev.sh` å®Œæˆåˆå§‹åŒ–
5. **é•¿æ—¶é—´ä¸ç”¨å** è¿è¡Œ `./bin/rebuild.sh status` æ£€æŸ¥æœåŠ¡çŠ¶æ€
